{% extends 'shop/base.html' %}
{% block title %}{{ title }} - {{ category }} - VSTech Limited {% endblock %}
{% block meta %}
	<meta name="title" content="{{ product.meta_title }}">
	<meta name="keywords" content="{{ product.meta_keywords }}">
	<meta name="description" content="{{ product.meta_description }}">
{% endblock %}
{% block content %}
	{% include 'partials/messages.html' %}
	<!--Product Details Start-->
	<section class="product-details">
		<div class="container pb-70">
			<div class="row">
				<div class="col-lg-6 col-xl-6">		
					<div class="bxslider">
						<div class="slider-content">
						  <figure class="image-box">
							<a href="{% if product.image %}{{ product.image.url }}{% else %}/static/images/resource/products/product-details.jpg{% endif %}" class="lightbox-image" data-fancybox="gallery">
							  <img src="{% if product.image %}{{ product.image.url }}{% else %}/static/images/resource/products/product-details.jpg{% endif %}" alt="{{ product.title }}" title="{{ product.title }}">
							</a>
						  </figure>
						  <div class="slider-pager">
							<ul class="thumb-box">
							  <li>
								<a class="active" data-slide-index="0" href="#">
								  <figure><img src="{% if product.image %}{{ product.image.url }}{% else %}/static/images/resource/products/product-details.jpg{% endif %}" alt="{{ product.title }}"></figure>
								</a>
							  </li>
							  {% for image in product.images.all %}
							  <li>
								<a data-slide-index="{{ forloop.counter }}" href="#">
								  <figure><img src="{{ image.image.url }}" alt=""></figure>
								</a>
							  </li>
							  {% endfor %}
							</ul>
						  </div>
						</div>
						{% for image in product.images.all %}
						<div class="slider-content">
						  <figure class="image-box">
							<a href="{{ image.image.url }}" class="lightbox-image" data-fancybox="gallery">
							  <img src="{{ image.image.url }}" alt="{{ product.title }}" title="{{ product.title }}">
							</a>
						  </figure>
						  <div class="slider-pager">
							<ul class="thumb-box">
							  <li>
								<a {% if forloop.counter == 0 %}class="active"{% endif %} data-slide-index="{{ forloop.counter }}" href="#">
								  <figure><img src="{% if product.image %}{{ product.image.url }}{% else %}/static/images/resource/products/product-details.jpg{% endif %}" alt="{{ product.title }}"></figure>
								</a>
							  </li>
							  {% for img in product.images.all %}
							  <li>
								<a {% if forloop.counter == forloop.parentloop.counter %}class="active" {% endif %}data-slide-index="{{ forloop.counter }}" href="#">
								  <figure><img src="{{ img.image.url }}" alt=""></figure>
								</a>
							  </li>
							  {% endfor %}
							</ul>
						  </div>
						</div>
						{% endfor %}
					  </div>
					  
					  
				</div>
				<div class="col-lg-6 col-xl-6 product-info">
					<div class="product-details__top">
						<h3 class="product-details__title">{{ product.title }} <span><del class="text-danger">{% if product.discount %}Ksh. {{ product.get_initial_price }}{% endif %}</del> <br>
							Ksh. {{ product.current_price }}</span> </h3>
					</div>
					{% if product.get_average_rating %}
						<div class="product-details__reveiw">
							{% for star in "*****" %}
								{% if forloop.counter <= product.get_average_rating %}
									<li><i class="fas fa-star"></i></li>
								{% else %}
									<li><i class="far fa-star"></i></li>
								{% endif %}
							{% endfor %}
							<span>{{ product.reviews.all.count }} Customer Reviews</span>
						</div>
					{% endif %}
					<div class="product-details__content">
						<p class="product-details__content-text1">{{ product.description|truncatechars:200 }}</p>
						<p class="product-details__content-text2">
							{% if product.discount %}<strong>DISCOUNT.</strong><span class="alert alert-info py-0 mx-3">{{ product.discount }}% OFF</span> <br>{% endif %} <br>
							{% if product.in_stock %}<span class="alert alert-success py-2">{{ product.in_stock }} in stock</span>{% else %}<span class="alert alert-danger py-2">Out of Stock</span>{% endif %}						
						</p>
					</div>

					<form action="{% url 'shop:cart_add' product.id %}" method="post">
						<div class="product-details__quantity">
							<h3 class="product-details__quantity-title">Choose quantity</h3>
							<div class="quantity-box">
									{% csrf_token %}
									<button type="button" class="sub"><i class="fa fa-minus"></i></button>
									<input type="number" id="1" name="quantity" value="1" required/>
									<button type="button" class="add"><i class="fa fa-plus"></i></button>
							</div>
						</div>
						
						
						<div class="product-details__buttons">
							<div class="product-details__buttons-1">
								<button type="submit" class="theme-btn btn-style-one">Add to Cart</button>
							</div>
							<!-- <div class="product-details__buttons-2">
								<a href="" class="theme-btn btn-style-one"><span class="btn-title">Add to Wishlist</span></a>
							</div> -->
						</div>
					</form>
					<div class="product-details__social">
						<div class="title mt-10">
							<h3>Share with friends</h3>
						</div>
						<ul class="social-icon-one">
							<li><a href="https://twitter.com/intent/tweet?text={{ product_text }}&url={{ product_full_url }}"><i class="fab fa-twitter"></i></a> </li>
							<li><a href="https://www.linkedin.com/shareArticle?mini=true&url={{ product_full_url }}&title={{ product.title }}"><i class="fab fa-linkedin"></i></a> </li>
							<li><a href="mailto:{{ post.author.email }}?subject={{ post.title }}&body={{ product_text }}{{ product_full_url }}"><i class="fa fa-envelope"></i></a> </li>
							<li><a href="https://www.facebook.com/sharer/sharer.php?u={{ product_full_url }}"><i class="fab fa-facebook"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--Product Details End-->

	<!--Product Description Start-->
	<section class="product-description">
		<div class="container pt-0 pb-90">
			<div class="product-discription">
				<div class="tabs-box">
					<div class="tab-btn-box text-center">
						<ul class="tab-btns tab-buttons clearfix">
							<li class="tab-btn active-btn" data-tab="#tab-1">Description</li>
							<li class="tab-btn" data-tab="#tab-2">{{ product.reviews.all.count }} Reviews</li>
						</ul>
					</div>
					<div class="tabs-content">
						<div class="tab active-tab" id="tab-1">
							<div class="text">
								<h3 class="product-description__title">Description</h3>
								<p class="product-description__text1">
									{{ product.description|linebreaks }}
								</p>
							</div>
						</div>
						<div class="tab" id="tab-2">
							<div class="customer-comment">
								<div class="row clearfix">
									{% if product.reviews.all %}
										{% for review in product.reviews.all %}
										<div class="col-lg-6 col-md-6 col-sm-12 mt-2 comment-column">
											<div class="single-comment-box">
												<div class="inner-box">
													<figure class="comment-thumb">
														<img src="
															{% if review.user.profile.image %}
																{{ review.user.profile.image.url }}
															{% else %}
																{% if review.user.profile.gender == 'male' %}
																	/static/images/1.png
																{% elif review.user.profile.gender == 'female' %}
																	/static/images/2.png
																{% else %}
																	/static/images/3.png
																{% endif %}
															{% endif %}" alt="{{ review.user.get_full_name }}" title="{{ review.user.get_full_name }}">
													</figure>
													<div class="inner">
														<ul class="rating clearfix">
															{% for star in "*****" %}
																{% if forloop.counter <= review.rating %}
																	<li><i class="fas fa-star"></i></li>
																{% else %}
																	<li><i class="far fa-star"></i></li>
																{% endif %}
															{% endfor %}
														</ul>
														<h5>{{ review.user.get_full_name|default:'No Name' }}, <span>{{ review.created_at }}</span></h5>
														<p>{{ review.message|linebreaks }}</p>
													</div>
												</div>
											</div>
										</div>
										{% endfor %}
									{% else %}
										<p>No Review added, be the First</p>
									{% endif %}
								</div>
							</div>
							<div class="comment-box">
								<h3>Add Your Comments</h3>
								<form id="contact_form" name="contact_form" class="" action="{% url 'shop:add_review' product.slug %}" method="POST">
									{% csrf_token %}
									<div class="mb-3">
										<textarea name="message" class="form-control required" rows="7" required placeholder="Enter Message"></textarea>
									</div>
									<div class="col-lg-12 col-md-12 col-sm-12 column mb-3">
											<p>Your Review</p>
											<div id="rating"></div>
												<input type="hidden" name="rating" id="rating-input" required>
									</div>
									<div class="mb-3">
										<input name="form_botcheck" class="form-control" type="hidden" value="" />
										<button type="submit" class="theme-btn btn-style-one" data-loading-text="Please wait..."><span class="btn-title">Submit Comment</span></button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--Product Description End-->
	{% if related_products %}
	<section class="related-product">
		<div class="container pt-0 pb-90">
			<h3>Related Products</h3>
			<div class="row clearfix">
				<div class="col">
					<!--MixitUp Galery-->
					<div class="mixitup-gallery">
						<div class="filter-list row">
							{% for r_product in related_products %}
							<!--Product Block-->
							<div class="product-block all mix pantry fruit col-lg-3 col-md-6 col-sm-12">
								<div class="inner-box">
									<div class="image">
										<a href="{{ r_product.get_absolute_url }}">
											<img src="{% if r_product.image %}{{ r_product.image.url }}{% else %}/static/images/resource/products/product-details.jpg{% endif %}" alt="{{ r_product }}"/>
										</a>
									</div>
									<div class="content">
										<h4><a href="{{ r_product.get_absolute_url }}">{{ r_product.title|truncatechars:30 }}</a></h4>
										<span class="price">
											<del class="text-danger">{% if product.discount %}Ksh. {{ product.get_initial_price }}{% endif %}</del> <br>
													Ksh. {{ product.current_price }}	
										</span>
										<div class="d-flex">
										{% if product.in_stock %}<span class="alert alert-success p-0 mx-2">{{ product.in_stock }} in stock</span>{% else %}<span class="alert alert-danger mx-2 p-0">Out of Stock</span>{% endif %}
												{% if product.discount %}<span class="alert alert-info p-0">{{ product.discount }}% OFF</span>{% endif %}
										</div>
										<span class="rating">
											{% for star in "*****" %}
												{% if forloop.counter <= product.get_average_rating %}
													<i class="fas fa-star"></i>
												{% else %}
													<i class="far fa-star"></i>
												{% endif %}
											{% endfor %}
										</span>
									</div>
									<div class="icon-box">
										<a href="{{ r_product.get_absolute_url }}" class="ui-btn like-btn"><i class="fa fa-heart"></i></a>
										<form action="{% url 'shop:cart_add' r_product.id %}" method="post">
											{% csrf_token %}
											<input type="hidden" name="quantity" value="1">
											<button type="submit"><a class="ui-btn add-to-cart"><i class="fa fa-shopping-cart"></i></a></button>
										</form>
									</div>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	{% endif %}
{% endblock %}
{% block js %}
<script src="/static/js/jquery.js"></script>
<script src="/static/js/popper.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/jquery.fancybox.js"></script>
<script src="/static/js/jquery-ui.js"></script>
<script src="/static/js/jquery.countdown.js"></script>
<script src="/static/js/bxslider.js"></script>
<script src="/static/js/mixitup.js"></script>
<script src="/static/js/wow.js"></script>
<script src="/static/js/appear.js"></script>
<script src="/static/js/select2.min.js"></script>
<script src="/static/js/swiper.min.js"></script>
<script src="/static/js/owl.js"></script>
<script src="/static/js/script.js"></script>

<!-- form submit -->
<script src="/static/js/jquery.validate.min.js"></script>
<script src="/static/js/jquery.form.min.js"></script>
<!-- Place this script at the bottom of the body tag -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
<script>
    $(function() {
        $("#rating").rateYo({
            rating: 5, // Set the default rating here
            fullStar: true, // Enable full stars
            onSet: function(rating, rateYoInstance) {
                // Set the value of the hidden input field when the rating is changed
                $("#rating-input").val(rating);
            }
        });
    });
</script>
{% endblock %}
